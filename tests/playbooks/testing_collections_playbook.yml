---
- name: Testing EDA Server
  hosts: localhost
  connection: local
  gather_facts: false
  collections:
    - infra.eda_configuration
  pre_tasks:
    - name: Include vars from eda_configs directory
      ansible.builtin.include_vars:
        dir: ./eda_configs
        extensions: ["yml"]
      tags:
        - always

  tasks:
    - name: Verify EDA Controller is up
      ansible.builtin.uri:
        validate_certs: false
        url: "{{ eda_hostname }}/api/eda/v1/users/me/"
        url_username: "{{ eda_username }}"
        url_password: "{{ eda_password }}"
        status_code:
          - 200
        force_basic_auth: true

    - name: Create user
      ansible.builtin.include_role:
        name: user
        apply:
          tags:
            - user
      tags:
        - user

    - name: Create project
      ansible.builtin.include_role:
        name: project
        apply:
          tags:
            - project
      tags:
        - project

    - name: Sync project
      ansible.builtin.include_role:
        name: project_sync
        apply:
          tags:
            - project
            - project_sync
      tags:
        - project
        - project_sync

    - name: Create credential
      ansible.builtin.include_role:
        name: credential
        apply:
          tags:
            - credential
      tags:
        - credential

    - name: Create decision environment
      ansible.builtin.include_role:
        name: decision_environment
        apply:
          tags:
            - decision_environment
      tags:
        - decision_environment

    - name: Create user tokens
      ansible.builtin.include_role:
        name: user_token
        apply:
          tags:
            - user_token
      tags:
        - user_token

    - name: Create rulebook activations
      ansible.builtin.include_role:
        name: rulebook_activation
        apply:
          tags:
            - rulebook_activation
      tags:
        - rulebook_activation

...
